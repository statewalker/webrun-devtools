<!DOCTYPE html>
<html>
  <head>
    <title>Titre de la page</title>
    <style>
      main {
        margin: auto;
        max-width: 1000px;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Create Screenshot</h1>
      <p>This page automatically creates a screenshots of an external site.</p>
      <div id="screenshots"></div>
    </main>
    <script type="module">
      import initDevTools from "../dist/webrun-devtools.js";
      const apiKey = await prompt("Enter the API key generated by the WebRun DevTools Extension:", "SW_API_KEY_CHANGE_ME");

      createScreenshot({
        // API key generated by the extension
        apiKey,
        // URL of the site
        url: "https://www.google.com",
        // Container element, where the screenshot should be attached. In this case it is the document body
        container: document.querySelector("#screenshots")
      }).catch(console.error);

      async function createScreenshot({
        apiKey,
        url,
        container
      }) {
        const api = await initDevTools({ apiKey });
        try {
          // Open site in a new window
          const win = await api.windows.create({
            url,
            focused : true,
            width : 800,
            height : 600
          });

          // Await a little bit while site is loading...
          await new Promise(resolve => setTimeout(resolve, 300));

          // Capture a PNG screenshot of the active tab
          const imgUrl = await api.tabs.captureVisibleTab(win.id, {
            format: "png"
          });

          // Create an image
          const div = document.createElement('div');
          container.appendChild(div);
          div.innerHTML = `<a href="${url}" target="_blank">
            <img src="${imgUrl}" style="max-width: 400px;" />
          </a>`

          // Remove the window
          await api.windows.remove(win.id);

        } finally {
          // Cleanup resources and disconnect from the extension
          await api.close();
        }
      }
    </script>
  </body>
</html>